---
title: "10 Insights from Rhode Island School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{10 Insights from Rhode Island School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5
)

# Check if we can fetch data from RIDE
# If not, skip all code chunks that require data
can_fetch_data <- tryCatch({
  # Try a quick fetch to see if RIDE is accessible
  test_data <- rischooldata::fetch_enr(2024, use_cache = TRUE)
  nrow(test_data) > 0 && "n_students" %in% names(test_data)
}, error = function(e) {
 FALSE
})

# Set eval option based on data availability
knitr::opts_chunk$set(eval = can_fetch_data)
```

```{r load-packages, eval=TRUE}
library(rischooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

```{r data-unavailable, eval=!can_fetch_data, echo=FALSE, results='asis'}
cat("
**Note:** This vignette requires live data from the Rhode Island Department of Education (RIDE) Data Center.
The data source is currently unavailable. Please try again later or run this vignette locally with an active internet connection.

To fetch data manually:
```r
library(rischooldata)
enr <- fetch_enr(2024)
```
")
```

This vignette explores Rhode Island's public school enrollment data, surfacing key trends and demographic patterns across 16 years of data (2011-2026).

---

## 1. Rhode Island lost 15,000 students in a decade

Rhode Island's public school enrollment peaked around 145,000 students in 2011 and has been declining ever since, following national demographic trends.

```{r statewide-trend}
enr <- fetch_enr_multi(2011:2026)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#003366") +
  geom_point(size = 3, color = "#003366") +

  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Rhode Island Public School Enrollment (2011-2026)",
    subtitle = "Steady decline has cost the state over 15,000 students",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Providence dominates, serving nearly 17% of students

Providence is Rhode Island's largest district by far, enrolling about 23,000 students--nearly one in six Rhode Island students.

```{r top-districts}
enr_2026 <- fetch_enr(2026)

top_districts <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

top_districts
```

```{r top-districts-chart}
top_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = district_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "mako", begin = 0.2, end = 0.8) +
  labs(
    title = "Top 10 Rhode Island Districts by Enrollment (2026)",
    subtitle = "Providence leads, followed by Warwick and Cranston",
    x = "Number of Students",
    y = NULL
  )
```

---

## 3. COVID hit Providence hardest

Providence lost over 2,500 students during the pandemic while suburban districts held relatively steady.

```{r covid-impact}
covid_enr <- fetch_enr_multi(2019:2026)

providence_trend <- covid_enr |>
  filter(district_name == "Providence", is_district,
         subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - first(n_students))

providence_trend
```

---

## 4. Hispanic students now 30% of enrollment

Rhode Island's Hispanic population has grown dramatically, from about 17% in 2011 to over 30% today.

```{r demographics}
demographics <- enr_2026 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian", "multiracial")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Rhode Island Student Demographics (2026)",
    subtitle = "An increasingly diverse student population",
    x = "Number of Students",
    y = NULL
  )
```

---

## 5. Central Falls: Smallest city, biggest challenges

Central Falls has the highest poverty rate in Rhode Island--over 90% of students are economically disadvantaged.

```{r central-falls}
central_falls <- enr_2026 |>
  filter(grepl("Central Falls", district_name), is_district, grade_level == "TOTAL",
         subgroup %in% c("total_enrollment", "econ_disadv", "lep")) |>
  select(district_name, subgroup, n_students, pct) |>
  mutate(pct = round(pct * 100, 1))

central_falls
```

---

## 6. English learners are concentrated in urban cores

Rhode Island has a significant English learner population, but it's highly concentrated in Providence, Central Falls, and Pawtucket.

```{r ell}
ell_districts <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL", subgroup == "lep") |>
  filter(n_students >= 100) |>
  arrange(desc(pct)) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(district_name, n_students, pct) |>
  head(10)

ell_districts
```

```{r regional-chart}
ell_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, pct)) |>
  ggplot(aes(x = pct, y = district_name, fill = pct)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
  scale_fill_gradient(low = "#66B2FF", high = "#003366") +
  labs(
    title = "English Learners by District (2026)",
    subtitle = "Urban districts serve the vast majority of EL students",
    x = "Percent of Enrollment",
    y = NULL
  )
```

---

## 7. Charter schools serve 8,000+ students

Rhode Island's charter sector has grown steadily, now serving about 6% of state enrollment across 23 charter schools.

```{r charters}
charters <- enr_2026 |>
  filter(is_charter, is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  summarize(
    n_charters = n(),
    total_students = sum(n_students, na.rm = TRUE)
  )

charters
```

---

## 8. Kindergarten enrollment is stabilizing

After sharp COVID-era drops, kindergarten enrollment is slowly recovering toward pre-pandemic levels.

```{r k-trend}
k_trend <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "K") |>
  select(end_year, n_students) |>
  mutate(change = n_students - first(n_students))

k_trend
```

```{r growth-chart}
k_trend |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#E69F00") +
  geom_point(size = 3, color = "#E69F00") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Kindergarten Enrollment (2011-2026)",
    subtitle = "Recovering from COVID-era lows",
    x = "School Year",
    y = "Kindergarten Students"
  )
```

---

## 9. White students are now under 50%

Rhode Island public schools have crossed a demographic milestone--white students are no longer a majority.

```{r majority-minority}
race_trends <- enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "hispanic")) |>
  select(end_year, subgroup, pct) |>
  mutate(pct = round(pct * 100, 1)) |>
  pivot_wider(names_from = subgroup, values_from = pct)

race_trends
```

---

## 10. 36 districts in America's smallest state

Rhode Island's compact geography means district sizes vary wildly--from Providence's 23,000 to tiny districts with under 1,000 students.

```{r district-sizes}
size_buckets <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(size_bucket = case_when(
    n_students < 1000 ~ "Small (<1K)",
    n_students < 5000 ~ "Medium (1K-5K)",
    n_students < 10000 ~ "Large (5K-10K)",
    TRUE ~ "Very Large (10K+)"
  )) |>
  count(size_bucket) |>
  mutate(size_bucket = factor(size_bucket, levels = c("Small (<1K)", "Medium (1K-5K)", "Large (5K-10K)", "Very Large (10K+)")))

size_buckets
```

---

## Summary

Rhode Island's school enrollment data reveals:

- **Long-term decline**: The state has lost over 15,000 students since 2011
- **Providence dominance**: One district serves nearly 17% of all students
- **Demographic shift**: Hispanic enrollment has nearly doubled to 30%
- **Urban challenges**: Central Falls, Pawtucket, and Providence face the highest poverty rates
- **COVID recovery**: Kindergarten and overall enrollment are slowly stabilizing

These patterns shape school funding formulas and facility planning across the Ocean State.

---

*Data sourced from the Rhode Island Department of Education [Data Center](https://www.ride.ri.gov/InformationAccountability/RIEducationData.aspx).*
